[gcode_macro CAMERA_ALIGN_START]
variable_zero_x: 200.0
variable_zero_y: 50.0
variable_zero_z: 34.0
gcode:
  T0
  G0 X{printer['gcode_macro CAMERA_ALIGN_START'].zero_x} Y{printer['gcode_macro CAMERA_ALIGN_START'].zero_y} Z{printer['gcode_macro CAMERA_ALIGN_START'].zero_z}

[gcode_macro CAMERA_ALIGN_NEXT]
gcode:
  {% set tn = printer.toolchanger.tool_number|int %}
  {% set tcount = printer.toolchanger.tool_names|length %}
  {% if tn == 0 %}
    SET_GCODE_VARIABLE MACRO=CAMERA_ALIGN_START VARIABLE=zero_x VALUE={printer.toolhead.position[0]|float}
    SET_GCODE_VARIABLE MACRO=CAMERA_ALIGN_START VARIABLE=zero_y VALUE={printer.toolhead.position[1]|float}
    SET_GCODE_VARIABLE MACRO=CAMERA_ALIGN_START VARIABLE=zero_z VALUE={printer.toolhead.position[2]|float}
  {% else %}
    {% set xoffset = printer.toolhead.position[0]|float - printer['gcode_macro CAMERA_ALIGN_START'].zero_x %}
    {% set yoffset = printer.toolhead.position[1]|float - printer['gcode_macro CAMERA_ALIGN_START'].zero_y %}
    SET_TOOL_PARAMETER PARAMETER='gcode_x_offset' VALUE={xoffset}
    SET_TOOL_PARAMETER PARAMETER='gcode_y_offset' VALUE={yoffset}
    SAVE_TOOL_PARAMETER PARAMETER='gcode_x_offset'
    SAVE_TOOL_PARAMETER PARAMETER='gcode_y_offset'
  {% endif %}
  SELECT_TOOL T={ (tn+1) % tcount } RESTORE_AXIS=xyz